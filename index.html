<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Critical Minerals Project Demo</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet">
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
    <style>
        body { margin: 0; padding: 0; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; }
    </style>
</head>

<body>

<style>
    #menu {
    background: #fff;
    position: absolute;
    z-index: 1;
    top: 10px;
    right: 10px;
    border-radius: 3px;
    width: 120px;
    border: 1px solid rgba(0, 0, 0, 0.4);
    font-family: 'Open Sans', sans-serif;
    }
        
    #menu a {
    font-size: 13px;
    color: #404040;
    display: block;
    margin: 0;
    padding: 0;
    padding: 10px;
    text-decoration: none;
    border-bottom: 1px solid rgba(0, 0, 0, 0.25);
    text-align: center;
    }
        
    #menu a:last-child {
    border: none;
    }
        
    #menu a:hover {
    background-color: #f8f8f8;
    color: #404040;
    }
        
    #menu a.active {
    background-color: #3887be;
    color: #ffffff;
    }
        
    #menu a.active:hover {
    background: #3074a4;
    }
</style>

<nav id="menu"></nav>
<div id="map"></div>
 
<script>
	mapboxgl.accessToken = 'pk.eyJ1IjoieWluaGFvLWR0YSIsImEiOiJjbGp4d3k0eHAxenRiM3NtaTkxYXIxNngzIn0.UNpYLjZs3rvXN8UVYUShTg';
    const map = new mapboxgl.Map({
        container: 'map', // container ID
        // Choose from Mapbox's core styles, or make your own style with Mapbox Studio
        style: 'mapbox://styles/mapbox/satellite-v9', // style URL
        projection: 'globe', // Display the map as a globe, since satellite-v9 defaults to Mercator
        zoom: 4, // starting zoom
        center: [135, -30] // // starting center in [lng, lat]
    });
    


    map.on('style.load', () => {
        map.setFog({}); // Set the default atmosphere style

        // Add 3D terrain to a map
        map.addSource('mapbox-dem', {
            'type': 'raster-dem',
            'url': 'mapbox://mapbox.mapbox-terrain-dem-v1',
            'tileSize': 512,
            'maxzoom': 14
        });
        // add the DEM source as a terrain layer with exaggerated height
        map.setTerrain({ 'source': 'mapbox-dem', 'exaggeration': 1.5 });

    });
    



    // Add a click event listener to the map
    map.on('click', function(e) {
        // Get the clicked coordinates
        var lngLat = e.lngLat;

        // Check if the circle layer already exists
        ['circle', 'circle2', 'circle3'].forEach(function(id) {
            if (map.getLayer(id)) {
                map.getSource(id).setData({
                    type: 'Feature',
                    geometry: {
                        type: 'Point',
                        coordinates: [lngLat.lng, lngLat.lat]
                    }
                });
            }else {
                // Create a new circle layer
                map.addLayer({
                id: 'circle',
                type: 'circle',
                source: {
                    type: 'geojson',
                    data: {
                    type: 'Feature',
                    geometry: {
                        type: 'Point',
                        coordinates: [lngLat.lng, lngLat.lat]
                    }
                    }
                },
                paint: {
                    'circle-radius': {
                    type: 'exponential',
                    stops: [
                        [0, 0],
                        [16, 100000] // Radius of 100km (in meters) at zoom level 16
                    ],
                    base: 2
                    },
                    'circle-color': 'rgba(0, 0, 255, 0.5)'
                }
                });

                map.addLayer({
                    id: 'circle2',
                    type: 'circle',
                    source: {
                        type: 'geojson',
                        data: {
                        type: 'Feature',
                        geometry: {
                            type: 'Point',
                            coordinates: [lngLat.lng, lngLat.lat]
                        }
                        }
                    },
                    paint: {
                        'circle-radius': {
                        type: 'exponential',
                        stops: [
                            [0, 0],
                            [16, 200000] // Radius of 200km (in meters) at zoom level 16
                        ],
                        base: 2
                        },
                        'circle-color': 'rgba(255, 0, 0, 0.5)'
                    }
                });

                map.addLayer({
                    id: 'circle3',
                    type: 'circle',
                    source: {
                        type: 'geojson',
                        data: {
                        type: 'Feature',
                        geometry: {
                            type: 'Point',
                            coordinates: [lngLat.lng, lngLat.lat]
                        }
                        }
                    },
                    paint: {
                        'circle-radius': {
                        type: 'exponential',
                        stops: [
                            [0, 0],
                            [16, 300000] // Radius of 300km (in meters) at zoom level 16
                        ],
                        base: 2
                        },
                        'circle-color': 'rgba(0, 255, 0, 0.5)'
                    }
                });
            }

        })
    });



    map.on('load', () => {
        map.addSource('state-border', {
            type: 'geojson',
            data: 'https://raw.githubusercontent.com/rowanhogan/australian-states/master/states.geojson'
        });
        
        map.addLayer({
            'id': 'state-border-layer',
            'type': 'line',
            'source': 'state-border',
            'layout': {
                'visibility': 'visible' // Make the layer visible by default.
            },
            'paint': {
                'line-width': 1,
                // Use a get expression (https://docs.mapbox.com/mapbox-gl-js/style-spec/#expressions-get)
                // to set the line-color to a feature property value.
                'line-color': 'blue' // Set the line color to red
            }
        });



        map.addLayer({   // add a symbol layer
            'id': 'earthquakes-layer',
            'type': 'symbol',
            'source': 'earthquakes',
            'layout': {
                'visibility': 'visible', // Make the layer visible by default.
                'icon-image': 'hospital',
                'icon-allow-overlap': true
            },
            'paint': {
            }
        });

        

        map.addSource('diesel', {
            type: 'geojson',
            data: 'https://raw.githubusercontent.com/YinhaoDeng/geojson-test-repo/main/converted%20(1).geojson'
        });

        map.loadImage(
            'https://cdn4.iconfinder.com/data/icons/nuuline-fill-car-parts-service-repair/150/service_repair_automotive-46-512.png',
            (error, image) => {
            if (error) throw error;
            
            // Add the image to the map style.
            map.addImage('fuel-icon', image);
        });
        
        map.addLayer({
            'id': 'diesel-layer',
            'type': 'symbol',
            'source': 'diesel', // reference the data source
            'layout': {
                'visibility': 'visible', // Make the layer visible by default.
                'icon-image': 'fuel-icon', // reference the image
                'icon-size': 0.04
                }
            });
        



        map.addSource('primschool', {
            type: 'geojson',
            data: 'https://raw.githubusercontent.com/YinhaoDeng/geojson-test-repo/main/primschool.geojson'
        });

        map.loadImage(
            'https://cdn2.iconfinder.com/data/icons/flat-pack-1/64/Education-1024.png',
            (error, image) => {
            if (error) throw error;
            
            // Add the image to the map style.
            map.addImage('school-icon', image);
        });

        // add yellow dots
        map.addLayer({
            'id': 'primschool-layer',
            'type': 'symbol',
            'source': 'primschool',
            'layout': {
                'visibility': 'visible', // Make the layer visible by default.
                'icon-image': 'school-icon', // reference the image
                'icon-size': 0.02
            }
        });



        map.addSource('publichospital', {
            type: 'geojson',
            data: 'https://raw.githubusercontent.com/YinhaoDeng/geojson-test-repo/main/Publichospitals.geojson'
        });

        map.loadImage(
            'https://cdn3.iconfinder.com/data/icons/clinical-3/96/medic-1024.png',
            (error, image) => {
            if (error) throw error;
            
            // Add the image to the map style.
            map.addImage('hospital-icon', image);
        });

        // add black dots
        map.addLayer({
            'id': 'publichospital-layer',
            'type': 'symbol',
            'source': 'publichospital',
            'layout': {
                'visibility': 'visible', // Make the layer visible by default.
                'icon-image': 'hospital-icon', // reference the image
                'icon-size': 0.02
            }
        });


        // polygon shape
        map.addSource('irrigationarea', {
            type: 'geojson',
            data: 'https://raw.githubusercontent.com/YinhaoDeng/geojson-test-repo/main/IrrigationAreas_GDA2020.geojson'
        });

        map.addLayer({
            'id': 'irrigationarea-layer',
            'type': 'fill',
            'source': 'irrigationarea',
            'layout': {
                'visibility': 'visible' // Make the layer visible by default.
            },
            'paint': {
                'fill-color': '#0080ff', // blue color fill
                'fill-opacity': 0.5
            }
        });

     

        map.addSource('railway', {
            type: 'geojson',
            data: 'https://raw.githubusercontent.com/YinhaoDeng/geojson-test-repo/main/railoutput.geojson'
        });

        map.addLayer({
            'id': 'railway-line-layer',
            'type': 'line',
            'source': 'railway',
            'layout': {
                'visibility': 'visible' // Make the layer visible by default.
            },
            'paint': {
                'line-width': 0.5,
                // Use a get expression (https://docs.mapbox.com/mapbox-gl-js/style-spec/#expressions-get)
                // to set the line-color to a feature property value.
                'line-color': 'black' // Set the line color to red
            }
        });


        map.addSource('road', {
            type: 'geojson',
            data: 'https://raw.githubusercontent.com/YinhaoDeng/geojson-test-repo/main/StateMaintainedRoads.geojson'
        });
        
        map.addLayer({
            'id': 'road-line-layer',
            'type': 'line',
            'source': 'road',
            'layout': {
                'visibility': 'visible' // Make the layer visible by default.
            },
            'paint': {
                'line-width': 1,
                // Use a get expression (https://docs.mapbox.com/mapbox-gl-js/style-spec/#expressions-get)
                // to set the line-color to a feature property value.
                'line-color': 'white' // Set the line color to red
            }
        });


        


        // DTA LOGO
        map.loadImage(
            'https://raw.githubusercontent.com/YinhaoDeng/geojson-test-repo/main/May%2022%20logo.JPG',
            (error, image) => {
            if (error) throw error;
            
            // Add the image to the map style.
            map.addImage('LOGO', image);
            
            // Add a data source containing one point feature.
            map.addSource('point', {
                'type': 'geojson',
                'data': {
                    'type': 'FeatureCollection',
                    'features': [{
                        'type': 'Feature',
                        'geometry': {
                            'type': 'Point',
                            'coordinates': [138.60508569191964, -34.92571784010129]
                        }
                    }]
                }
            });

        // Add a layer to use the image to represent the data.
        map.addLayer({
            'id': 'points',
            'type': 'symbol',
            'source': 'point', // reference the data source
            'layout': {
                'icon-image': 'LOGO', // reference the image
                'icon-size': 0.1
            }
            });
            }
        );


            

        
    });




    // After the last frame rendered before the map enters an "idle" state.
    map.on('idle', () => {
        // TODO: modify this code, add more layers.             If these two layers were not added to the map, abort
        // if (!map.getLayer('earthquakes-layer')) {
        //     return;
        // }
    
        // Enumerate ids of the layers.
        const toggleableLayerIds = ['diesel-layer', 'primschool-layer', 'publichospital-layer', 'irrigationarea-layer', 'railway-line-layer', 'road-line-layer'];
        
        // Set up the corresponding toggle button for each layer.
        for (const id of toggleableLayerIds) {
            // Skip layers that already have a button set up.
            if (document.getElementById(id)) {
                continue;
            }
        
            // Create a link.
            const link = document.createElement('a');
            link.id = id;
            link.href = '#';
            link.textContent = id;
            link.className = 'active';
            
            // Show or hide layer when the toggle is clicked.
            link.onclick = function (e) {
                const clickedLayer = this.textContent;
                e.preventDefault();
                e.stopPropagation();
                
                const visibility = map.getLayoutProperty(
                    clickedLayer,
                    'visibility'
                );
        
                // Toggle layer visibility by changing the layout object's visibility property.
                if (visibility === 'visible') {
                    map.setLayoutProperty(clickedLayer, 'visibility', 'none');
                    this.className = '';
                } else {
                    this.className = 'active';
                    map.setLayoutProperty(
                        clickedLayer,
                        'visibility',
                        'visible'
                    );
                }
            };
        
            const layers = document.getElementById('menu');
            layers.appendChild(link);
        }





        // // Add a listener for the click event.
        // map.on('click', (e) => {
        // // Calculate the radius of the circle.
        //     const radius = 50000;

        //     // Create a new circle object.
        //     const circle = new mapboxgl.Circle({
        //         center: e.lngLat,
        //         radius,
        //         color: 'red',
        //         fillOpacity: 0.5,
        //     });

        //     // Add the circle to the map.
        //     circle.addTo(map);

        //     // Add some cool animations to the circle.
        //     circle.setAnimation('pulse', {
        //         duration: 2000,
        //         repeat: Infinity,
        // });
        // });
    });

</script>
 
</body>
</html>

